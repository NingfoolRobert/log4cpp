<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Category.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Dec 22 10:52:45 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>Category.cpp</h1><a href="Category_cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment"> * Category.cpp</font>
00003 <font class="comment"> *</font>
00004 <font class="comment"> * Copyright 2000, LifeLine Networks BV (www.lifeline.nl). All rights reserved.</font>
00005 <font class="comment"> * Copyright 2000, Bastiaan Bakker. All rights reserved.</font>
00006 <font class="comment"> *</font>
00007 <font class="comment"> * See the COPYING file for the terms of usage and distribution.</font>
00008 <font class="comment"> */</font>
00009 
00010 <font class="preprocessor">#include &lt;unistd.h&gt;</font>
00011 
00012 <font class="preprocessor">#include "<a class="code" href="Hints_hh.html">log4cpp/Hints.hh</a>"</font>
00013 <font class="preprocessor">#include "<a class="code" href="Category_hh.html">log4cpp/Category.hh</a>"</font>
00014 <font class="preprocessor">#include "<a class="code" href="HierarchyMaintainer_hh.html">log4cpp/HierarchyMaintainer.hh</a>"</font>
00015 <font class="preprocessor">#include "<a class="code" href="NDC_hh.html">log4cpp/NDC.hh</a>"</font>
00016 
00017 <font class="keyword">namespace</font> log4cpp {
00018 
<a name="l00019"></a><a class="code" href="class_log4cpp__CategoryStream.html#p0">00019</a>     CategoryStream::Separator CategoryStream::ENDLINE;
00020 
<a name="l00021"></a><a class="code" href="class_log4cpp__CategoryStream.html#a0">00021</a>     CategoryStream::CategoryStream(Category&amp; category, <font class="keywordtype">int</font> priority) :
00022         _category(category),
00023         _priority(priority),
00024         _buffer(NULL) {
00025     }
00026 
<a name="l00027"></a><a class="code" href="class_log4cpp__CategoryStream.html#a1">00027</a>     CategoryStream::~CategoryStream()<font class="keyword"> </font>{ 
00028         flush();
00029     }
00030 
<a name="l00031"></a><a class="code" href="class_log4cpp__CategoryStream.html#a4">00031</a>     CategoryStream&amp; CategoryStream::operator&lt;&lt;(<font class="keyword">const</font> CategoryStream::Separator&amp; separator)<font class="keyword"> </font>{
00032         flush();
00033         <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00034     }
00035 
<a name="l00036"></a><a class="code" href="class_log4cpp__CategoryStream.html#a5">00036</a>     <font class="keywordtype">void</font> CategoryStream::flush()<font class="keyword"> </font>{
00037         <font class="keywordflow">if</font> (_buffer) {
00038             (*_buffer) &lt;&lt; <font class="charliteral">'\0'</font>;
00039             getCategory().log(getPriority(), std::string(_buffer-&gt;str()));
00040             <font class="keyword">delete</font> _buffer;
00041             _buffer = NULL;
00042         }
00043     }
00044 
<a name="l00045"></a><a class="code" href="class_log4cpp__Category.html#d0">00045</a>     Category&amp; Category::getRoot()<font class="keyword"> </font>{
00046         <font class="keywordflow">return</font> getInstance(<font class="stringliteral">""</font>);
00047     }
00048 
<a name="l00049"></a><a class="code" href="class_log4cpp__Category.html#d1">00049</a>     <font class="keywordtype">void</font> Category::setRootPriority(<font class="keywordtype">int</font> priority)<font class="keyword"> </font>{
00050         getRoot().setPriority(priority);
00051     }
00052 
<a name="l00053"></a><a class="code" href="class_log4cpp__Category.html#d2">00053</a>     <font class="keywordtype">int</font> Category::getRootPriority()<font class="keyword"> </font>{
00054         <font class="keywordflow">return</font> getRoot().getPriority();
00055     }
00056 
<a name="l00057"></a><a class="code" href="class_log4cpp__Category.html#d3">00057</a>     Category&amp; Category::getInstance(<font class="keyword">const</font> std::string&amp; name)<font class="keyword"> </font>{
00058         <font class="keywordflow">return</font> HierarchyMaintainer::getDefaultMaintainer().getInstance(name);
00059     }
00060 
<a name="l00061"></a><a class="code" href="class_log4cpp__Category.html#d4">00061</a>     std::set&lt;Category*&gt;* Category::getCurrentCategories()<font class="keyword"> </font>{
00062         <font class="keywordflow">return</font> HierarchyMaintainer::getDefaultMaintainer().
00063             getCurrentCategories();
00064     }
00065 
00066     Category::Category(<font class="keyword">const</font> std::string&amp; name, Category* parent, <font class="keywordtype">int</font> priority) : 
00067         _name(name),
00068         _parent(parent),
00069         _priority(priority),
00070         _appender(NULL),
00071         _ownsAppender(false),
00072         _isAdditive(true) {
00073     }
00074 
<a name="l00075"></a><a class="code" href="class_log4cpp__Category.html#a0">00075</a>     Category::~Category()<font class="keyword"> </font>{
00076     }
00077     
<a name="l00078"></a><a class="code" href="class_log4cpp__Category.html#a2">00078</a>     <font class="keywordtype">void</font> Category::setPriority(<font class="keywordtype">int</font> priority)<font class="keyword"> </font>{
00079         _priority = priority;
00080     }
00081     
<a name="l00082"></a><a class="code" href="class_log4cpp__Category.html#a3">00082</a>     <font class="keywordtype">int</font> Category::getPriority()<font class="keyword"> const </font>{
00083         <font class="keywordflow">return</font> _priority;
00084     }
00085    
<a name="l00086"></a><a class="code" href="class_log4cpp__Category.html#a4">00086</a>     <font class="keywordtype">int</font> Category::getChainedPriority()<font class="keyword"> const </font>{
00087         <font class="comment">// REQUIRE(rootCategory-&gt;getPriority() != Priority::NOTSET)</font>
00088         
00089         <font class="keyword">const</font> Category* c = <font class="keyword">this</font>;
00090         <font class="keywordflow">while</font>(c-&gt;getPriority() == Priority::NOTSET) { 
00091             c = c-&gt;getParent();
00092         }
00093         
00094         <font class="keywordflow">return</font> c-&gt;getPriority();
00095     }
00096     
<a name="l00097"></a><a class="code" href="class_log4cpp__Category.html#a6">00097</a>     <font class="keywordtype">void</font> Category::setAppender(Appender* appender)<font class="keyword"> </font>{
00098         <font class="comment">// REQUIRE(appender != NULL)</font>
00099         <font class="keywordflow">if</font> (appender == NULL)
00100             <font class="keywordflow">return</font>;
00101         
00102         <font class="keywordflow">if</font> (ownsAppender())
00103             <font class="keyword">delete</font> _appender;
00104         
00105         _appender = appender;
00106         _ownsAppender = <font class="keyword">true</font>;    
00107     }
00108     
<a name="l00109"></a><a class="code" href="class_log4cpp__Category.html#a7">00109</a>     <font class="keywordtype">void</font> Category::setAppender(Appender&amp; appender)<font class="keyword"> </font>{
00110         <font class="keywordflow">if</font> (ownsAppender())
00111             <font class="keyword">delete</font> _appender;
00112         
00113         _appender = &amp;appender;
00114         _ownsAppender = <font class="keyword">false</font>;    
00115     }
00116     
<a name="l00117"></a><a class="code" href="class_log4cpp__Category.html#a8">00117</a>     Appender* Category::getAppender()<font class="keyword"> const </font>{
00118         <font class="keywordflow">return</font> _appender;
00119     }
00120     
<a name="l00121"></a><a class="code" href="class_log4cpp__Category.html#a9">00121</a>     <font class="keywordtype">bool</font> Category::ownsAppender()<font class="keyword"> const </font>{
00122         <font class="keywordflow">return</font> _ownsAppender;
00123     }
00124     
<a name="l00125"></a><a class="code" href="class_log4cpp__Category.html#a10">00125</a>     <font class="keywordtype">void</font> Category::callAppenders(<font class="keyword">const</font> LoggingEvent&amp; event)<font class="keyword"> </font>{
00126         <font class="keywordflow">if</font> (_appender) {
00127             _appender-&gt;doAppend(event);
00128         }
00129 
00130         <font class="keywordflow">if</font> (getAdditivity() &amp;&amp; (getParent() != NULL)) {
00131             getParent()-&gt;callAppenders(event);
00132         }
00133     }
00134 
<a name="l00135"></a><a class="code" href="class_log4cpp__Category.html#a11">00135</a>     <font class="keywordtype">void</font> Category::setAdditivity(<font class="keywordtype">bool</font> additivity)<font class="keyword"> </font>{
00136         _isAdditive = additivity;
00137     }
00138 
<a name="l00139"></a><a class="code" href="class_log4cpp__Category.html#b2">00139</a>     <font class="keywordtype">void</font> Category::_logUnconditionally(<font class="keywordtype">int</font> priority, <font class="keyword">const</font> <font class="keywordtype">char</font>* format, va_list arguments)<font class="keyword"> </font>{
00140         ostrstream messageBuffer;
00141 
00142         messageBuffer.vform(format, arguments);
00143         messageBuffer &lt;&lt; <font class="charliteral">'\0'</font>;
00144         std::string message = std::string(messageBuffer.str());
00145         _logUnconditionally2(priority, message);
00146     }
00147     
<a name="l00148"></a><a class="code" href="class_log4cpp__Category.html#b3">00148</a>     <font class="keywordtype">void</font> Category::_logUnconditionally2(<font class="keywordtype">int</font> priority, <font class="keyword">const</font> std::string&amp; message)<font class="keyword"> </font>{
00149         LoggingEvent event(getName(), message, NDC::get(), priority);
00150         callAppenders(event);
00151     }
00152     
<a name="l00153"></a><a class="code" href="class_log4cpp__Category.html#a5">00153</a>     <font class="keywordtype">bool</font> Category::isPriorityEnabled(<font class="keywordtype">int</font> priority)<font class="keyword"> const </font>{
00154         <font class="keywordflow">return</font>(getChainedPriority() &gt;= priority);
00155     }
00156 
<a name="l00157"></a><a class="code" href="class_log4cpp__Category.html#a13">00157</a>     <font class="keywordtype">void</font> Category::log(<font class="keywordtype">int</font> priority, <font class="keyword">const</font> <font class="keywordtype">char</font>* stringFormat, ...)<font class="keyword"> </font>{ 
00158         <font class="keywordflow">if</font> (isPriorityEnabled(priority)) {
00159             va_list va;
00160             va_start(va, stringFormat);
00161             _logUnconditionally(priority, stringFormat, va);
00162             va_end(va);
00163         }
00164     }
00165     
<a name="l00166"></a><a class="code" href="class_log4cpp__Category.html#a14">00166</a>     <font class="keywordtype">void</font> Category::log(<font class="keywordtype">int</font> priority, <font class="keyword">const</font> std::string&amp; message)<font class="keyword"> </font>{ 
00167         <font class="keywordflow">if</font> (isPriorityEnabled(priority))
00168             _logUnconditionally2(priority, message);
00169     }
00170     
<a name="l00171"></a><a class="code" href="class_log4cpp__Category.html#a15">00171</a>     <font class="keywordtype">void</font> Category::debug(<font class="keyword">const</font> <font class="keywordtype">char</font>* stringFormat, ...)<font class="keyword"> </font>{ 
00172         <font class="keywordflow">if</font> (isPriorityEnabled(Priority::DEBUG)) {
00173             va_list va;
00174             va_start(va,stringFormat);
00175             _logUnconditionally(Priority::DEBUG, stringFormat, va);
00176             va_end(va);
00177         }
00178     }
00179     
<a name="l00180"></a><a class="code" href="class_log4cpp__Category.html#a16">00180</a>     <font class="keywordtype">void</font> Category::debug(<font class="keyword">const</font> std::string&amp; message)<font class="keyword"> </font>{ 
00181         <font class="keywordflow">if</font> (isPriorityEnabled(Priority::DEBUG))
00182             _logUnconditionally2(Priority::DEBUG, message);
00183     }
00184     
<a name="l00185"></a><a class="code" href="class_log4cpp__Category.html#a19">00185</a>     <font class="keywordtype">void</font> Category::info(<font class="keyword">const</font> <font class="keywordtype">char</font>* stringFormat, ...)<font class="keyword"> </font>{ 
00186         <font class="keywordflow">if</font> (isPriorityEnabled(Priority::INFO)) {
00187             va_list va;
00188             va_start(va,stringFormat);
00189             _logUnconditionally(Priority::INFO, stringFormat, va);
00190             va_end(va);
00191         }
00192     }
00193     
<a name="l00194"></a><a class="code" href="class_log4cpp__Category.html#a20">00194</a>     <font class="keywordtype">void</font> Category::info(<font class="keyword">const</font> std::string&amp; message)<font class="keyword"> </font>{ 
00195         <font class="keywordflow">if</font> (isPriorityEnabled(Priority::INFO))
00196             _logUnconditionally2(Priority::INFO, message);
00197     }
00198     
<a name="l00199"></a><a class="code" href="class_log4cpp__Category.html#a23">00199</a>     <font class="keywordtype">void</font> Category::warn(<font class="keyword">const</font> <font class="keywordtype">char</font>* stringFormat, ...)<font class="keyword"> </font>{ 
00200         <font class="keywordflow">if</font> (isPriorityEnabled(Priority::WARN)) {
00201             va_list va;
00202             va_start(va,stringFormat);
00203             _logUnconditionally(Priority::WARN, stringFormat, va);
00204             va_end(va);
00205         }
00206     }
00207     
<a name="l00208"></a><a class="code" href="class_log4cpp__Category.html#a24">00208</a>     <font class="keywordtype">void</font> Category::warn(<font class="keyword">const</font> std::string&amp; message)<font class="keyword"> </font>{ 
00209         <font class="keywordflow">if</font> (isPriorityEnabled(Priority::WARN))
00210             _logUnconditionally2(Priority::WARN, message);
00211     }
00212     
<a name="l00213"></a><a class="code" href="class_log4cpp__Category.html#a27">00213</a>     <font class="keywordtype">void</font> Category::error(<font class="keyword">const</font> <font class="keywordtype">char</font>* stringFormat, ...)<font class="keyword"> </font>{ 
00214         <font class="keywordflow">if</font> (isPriorityEnabled(Priority::ERROR)) {
00215             va_list va;
00216             va_start(va,stringFormat);
00217             _logUnconditionally(Priority::ERROR, stringFormat, va);
00218             va_end(va);
00219         }
00220     }
00221     
<a name="l00222"></a><a class="code" href="class_log4cpp__Category.html#a28">00222</a>     <font class="keywordtype">void</font> Category::error(<font class="keyword">const</font> std::string&amp; message)<font class="keyword"> </font>{ 
00223         <font class="keywordflow">if</font> (isPriorityEnabled(Priority::ERROR))
00224             _logUnconditionally2(Priority::ERROR, message);
00225     }
00226 
<a name="l00227"></a><a class="code" href="class_log4cpp__Category.html#a31">00227</a>     CategoryStream Category::getStream(<font class="keywordtype">int</font> priority)<font class="keyword"> </font>{
00228         <font class="keywordflow">return</font> CategoryStream(*<font class="keyword">this</font>, isPriorityEnabled(priority) ?
00229                               priority : Priority::NOTSET);
00230     }
00231 
<a name="l00232"></a><a class="code" href="class_log4cpp__Category.html#a32">00232</a>     CategoryStream Category::operator&lt;&lt;(<font class="keywordtype">int</font> priority)<font class="keyword"> </font>{
00233         <font class="keywordflow">return</font> getStream(priority);
00234     }
00235 } 
00236 
</div></pre><hr><address><small>Generated at Fri Dec 22 10:52:45 2000 for log4cpp by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
