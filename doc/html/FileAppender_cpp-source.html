<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>FileAppender.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Dec 22 10:52:45 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>FileAppender.cpp</h1><a href="FileAppender_cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment"> * FileAppender.cpp</font>
00003 <font class="comment"> *</font>
00004 <font class="comment"> * Copyright 2000, LifeLine Networks BV (www.lifeline.nl). All rights reserved.</font>
00005 <font class="comment"> * Copyright 2000, Bastiaan Bakker. All rights reserved.</font>
00006 <font class="comment"> *</font>
00007 <font class="comment"> * See the COPYING file for the terms of usage and distribution.</font>
00008 <font class="comment"> */</font>
00009 
00010 <font class="preprocessor">#include &lt;unistd.h&gt;</font>
00011 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00012 <font class="preprocessor">#include &lt;time.h&gt;</font>
00013 <font class="preprocessor">#include &lt;sys/types.h&gt;</font>
00014 <font class="preprocessor">#include &lt;sys/stat.h&gt;</font>
00015 <font class="preprocessor">#include &lt;fcntl.h&gt;</font>
00016 <font class="preprocessor">#include "<a class="code" href="FileAppender_hh.html">log4cpp/FileAppender.hh</a>"</font>
00017 <font class="preprocessor">#include "<a class="code" href="Category_hh.html">log4cpp/Category.hh</a>"</font>
00018 
00019 <font class="keyword">namespace</font> log4cpp {
00020 
<a name="l00021"></a><a class="code" href="class_log4cpp__FileAppender.html#a0">00021</a>     FileAppender::FileAppender(<font class="keyword">const</font> std::string&amp; name, <font class="keyword">const</font> std::string&amp; fileName) : 
00022         Appender(name),
00023         _fileName(fileName) {
00024         _fd = ::open(_fileName.c_str(), O_CREAT | O_APPEND | O_WRONLY, 00644);  
00025     }
00026     
<a name="l00027"></a><a class="code" href="class_log4cpp__FileAppender.html#a1">00027</a>     FileAppender::FileAppender(<font class="keyword">const</font> std::string&amp; name, <font class="keywordtype">int</font> fd) :
00028         Appender(name),
00029         _fileName(""),
00030         _fd(fd) {
00031     }
00032     
<a name="l00033"></a><a class="code" href="class_log4cpp__FileAppender.html#a2">00033</a>     FileAppender::~FileAppender()<font class="keyword"> </font>{
00034         close();
00035     }
00036 
<a name="l00037"></a><a class="code" href="class_log4cpp__FileAppender.html#a5">00037</a>     <font class="keywordtype">void</font> FileAppender::close()<font class="keyword"> </font>{
00038         ::close(_fd);
00039     }
00040 
<a name="l00041"></a><a class="code" href="class_log4cpp__FileAppender.html#a3">00041</a>     <font class="keywordtype">void</font> FileAppender::doAppend(<font class="keyword">const</font> LoggingEvent&amp; event)<font class="keyword"> </font>{
00042         <font class="keywordflow">if</font> (!_layout) {
00043             <font class="comment">// XXX help! help!</font>
00044             <font class="keywordflow">return</font>;
00045         }
00046 
00047         <font class="keywordtype">char</font>* message = _layout-&gt;format(event);
00048         <font class="keywordflow">if</font> (!::write(_fd, message, strlen(message))) {
00049             <font class="comment">// XXX help! help!</font>
00050         }
00051 
00052         free(message);
00053     }
00054 
<a name="l00055"></a><a class="code" href="class_log4cpp__FileAppender.html#a4">00055</a>     <font class="keywordtype">bool</font> FileAppender::reopen()<font class="keyword"> </font>{
00056         <font class="keywordflow">if</font> (_fileName != <font class="stringliteral">""</font>) {
00057             <font class="keywordtype">int</font> fd = ::open(_fileName.c_str(), O_CREAT | O_APPEND | O_WRONLY, 00644);
00058             <font class="keywordflow">if</font> (fd &lt; 0)
00059                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00060             <font class="keywordflow">else</font> {
00061                 <font class="keywordtype">int</font> oldfd = _fd;
00062                 _fd = fd;
00063                 ::close(oldfd);
00064                 <font class="keywordflow">return</font> <font class="keyword">true</font>;
00065             }
00066         } <font class="keywordflow">else</font> {
00067             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00068         }      
00069     }
00070 
<a name="l00071"></a><a class="code" href="class_log4cpp__FileAppender.html#a6">00071</a>     <font class="keywordtype">bool</font> FileAppender::requiresLayout()<font class="keyword"> const </font>{
00072         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00073     }
00074 
<a name="l00075"></a><a class="code" href="class_log4cpp__FileAppender.html#a7">00075</a>     <font class="keywordtype">void</font> FileAppender::setLayout(Layout* layout)<font class="keyword"> </font>{
00076         _layout = layout;
00077     }
00078 
00079 }
</div></pre><hr><address><small>Generated at Fri Dec 22 10:52:45 2000 for log4cpp by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
